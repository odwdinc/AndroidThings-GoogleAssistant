Google Assistant API Sample for Android Things
==============================================

This sample shows how to call the Google Assistant API from Android Things.

It records a spoken request from the connected microphones, sends it to the Google Assistant API and plays back the Assistant's spoken response on the connected speaker.
Implements an API.AI Agent with a Firebase Function fulfillment backend, with a Firebase Database to syinc data to Android Things.
Fulfillment of spoken request can be generated by Android Things or API.AI, then plays back the Assistant's spoken response on the connected speaker.

Pre-requisites
--------------

- Android Studio 2.2+.
- Android Things [Joule Board][Joule_Board].
- Android Things: supported [microphone][mic] and [speaker][speaker].
- [Grove - LCD RGB Backlight][jhd1313m1].
- [Google API Console Project][console].
- [API.AI Agent][API-AI-Agent] An Actions project defines metadata about your app and lets you track your app through the approval process. An API.AI agent defines intents that map what users can say to a corresponding response, which is returned by fulfillment.
- [Actions on Google][AOgoogle] lets developers build apps for the Google Assistant.
- [Firebase][firebase] Tools from Google for developing great apps, engaging with your users

Setup Web Function and Servicers
--------------

- Configure the Google API Console Project to use the [Google Assistant API][google-assistant-api-config].
- Download the `client_secret_NNNN.json` file from the [credentials section of the Console][console-credentials].
- Use the [`google-oauthlib-tool`][google-oauthlib-tool] to generate credentials:
```
pip install google-auth-oauthlib[tool]
google-oauthlib-tool --client-secrets client_secret_NNNN.json \
                     --credentials app/src/main/res/raw/credentials.json \
                     --scope https://www.googleapis.com/auth/assistant-sdk-prototype \
                     --save
```
- Make sure to set the [Activity Controls][set-activity-controls] for the Google Account using the application.
- [Deploy][fulfillment] the [firebase-assistant-androidthings][this-action] function, the PROJECT_ID  need to match the one created in the above steps. Save the Function URL from the **firebase deploy** command.
- Go to the Actions on [Google Developer Console][AOgoogle].
  - Click on **Add/Import project**,
  - Click on **Enter name or choose a project**,
  - Find and Click on the project created in the above steps,
  - Click on **Import Project**,
- **API.AI**
  - Fill out the **newAgent** page
    - **GOOGLE PROJECT**: Needs to be set to the same project as created in the above steps.
    - Save
  - Click the settings icon next to the name of the Agent.
    - Click on **Export and Import**
    - Click on Import from Zip, Upload the [JouleBoard.zip][JouleBoard]
    - Save
  - Click Integrations
    - Enable **Actions on Google.**
    - Set any Additional triggering intents.
    - Save/Update
  - Click Fulfillment
    - **ENABLED** Webhooks
    - set **URL*** to the firebase function URL from the above steps.
    - set **DOMAINS** to  **Enable webhook for all domains**.
    - Save
    
Run the sample
--------------
- Connect the mic and speeker to a usb hub and plug the hub into the usb port on the[Joule Board][Joule_Board].
- Connect the[Grove - LCD RGB Backlight][jhd1313m1]to **I2C0** on the[Joule Board][Joule_Board]
- On the first install, grant the sample required permissions for audio and internet access:
```bash
./gradlew assembleDebug
adb install -g app/build/outputs/apk/app-debug.apk
```
- On Android Studio, click on the "Run" button or on the command line, type:
```bash
./gradlew installDebug
adb shell am start com.example.androidthings.assistant/.AssistantActivity
```
- Try the assistant Action on Google:
  - Press the button: recording starts.
  - Use the microphone to say **"talk to"** name of  **Action on Google** you setup.
  - Release the button: recording stops.
  - The Google Assistant answer should playback on the speaker that it is featching the test vertion of your **Action on Google**.
  - Try saying things like:
    - **"Display Hello World on LCD"**
    - **"Turn on LED 1"**
    - **"Turn off LED 1"**
  - To Stop your **Action on Google** say **"stop"**.
    
License
-------

Copyright 2017 The Android Open Source Project, Inc.

Licensed to the Apache Software Foundation (ASF) under one or more contributor
license agreements.  See the NOTICE file distributed with this work for
additional information regarding copyright ownership.  The ASF licenses this
file to you under the Apache License, Version 2.0 (the "License"); you may not
use this file except in compliance with the License.  You may obtain a copy of
the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
License for the specific language governing permissions and limitations under
the License.


[jhd1313m1]: https://www.seeedstudio.com/Grove-LCD-RGB-Backlight-p-1643.html
[Joule_Board]: https://developer.android.com/things/hardware/joule.html
[JouleBoard]: https://github.com/odwdinc/AndroidThings-GoogleAssistant/tree/master/api.ai/JouleBoard.zip
[this-action]: https://github.com/odwdinc/AndroidThings-GoogleAssistant/tree/master/firebase-assistant-androidthings
[firebase]: https://console.firebase.google.com/
[AOgoogle]: https://console.actions.google.com
[fulfillment]: https://developers.google.com/actions/get-started/deploy-fulfillment
[API-AI-Agent]: https://docs.api.ai/docs/get-started
[voice-kit]: https://aiyprojects.withgoogle.com/voice/
[console]: https://console.developers.google.com
[google-assistant-api-config]: https://developers.google.com/assistant/sdk/prototype/getting-started-other-platforms/config-dev-project-and-account
[console-credentials]: https://console.developers.google.com/apis/credentials
[google-oauthlib-tool]: https://github.com/GoogleCloudPlatform/google-auth-library-python-oauthlib
[dev-preview-download]: https://dl.google.com/dl/androidthings/rpi3/devpreview/3.1/androidthings_rpi3_devpreview_3_1.zip
[set-activity-controls]: https://developers.google.com/assistant/sdk/prototype/getting-started-other-platforms/config-dev-project-and-account#set-activity-controls
[mic]: https://www.adafruit.com/product/3367
[speaker]: https://www.adafruit.com/product/3369
